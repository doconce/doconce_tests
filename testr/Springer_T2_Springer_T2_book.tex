%%
%% Automatically generated file from DocOnce source
%% (https://github.com/doconce/doconce/)
%% doconce format latex Springer_T2_book.do.txt CHAPTER=chapter BOOK=book APPENDIX=appendix -DPRIMER_BOOK ALG=code --latex_code_style=lst --encoding=utf-8 --device=paper --exercise_numbering=chapter --latex_admon_color=1,1,1 --latex_admon=mdfbox --latex_style=Springer_T4 --latex_title_layout=titlepage --latex_list_of_exercises=loe --latex_table_format=center --latex_admon_title_no_period --exercises_in_zip --exercises_in_zip_filename=chapter --allow_refs_to_external_docs

% #define PREAMBLE

% #ifdef PREAMBLE
%-------------------- begin preamble ----------------------

% Style: T4 (Springer)
% Use svmono.cls with doconce modifications for bibliography (svmonodo.cls)
\documentclass[graybox,sectrefs,envcountresetchap,open=right,final]{svmonodo}

% Use t4.sty with doconce modifications (t4do.sty)
\usepackage{t4do}
\special{papersize=178mm,254mm}

\listfiles               %  print all files needed to compile this document

\usepackage{relsize,makeidx,color,setspace,amsmath,amsfonts,amssymb}
\usepackage[table]{xcolor}
\usepackage{bm,ltablex,microtype}

\usepackage{graphicx}

% Packages for typesetting blocks of computer code
\usepackage{fancyvrb,framed,moreverb}

% Define colors
\definecolor{orange}{cmyk}{0,0.4,0.8,0.2}
\definecolor{tucorange}{rgb}{1.0,0.64,0}
\definecolor{darkorange}{rgb}{.71,0.21,0.01}
\definecolor{darkgreen}{rgb}{.12,.54,.11}
\definecolor{myteal}{rgb}{.26, .44, .56}
\definecolor{gray}{gray}{0.45}
\definecolor{mediumgray}{gray}{.8}
\definecolor{lightgray}{gray}{.95}
\definecolor{brown}{rgb}{0.54,0.27,0.07}
\definecolor{purple}{rgb}{0.5,0.0,0.5}
\definecolor{darkgray}{gray}{0.25}
\definecolor{darkblue}{rgb}{0,0.08,0.45}
\definecolor{darkblue2}{rgb}{0,0,0.8}
\definecolor{lightred}{rgb}{1.0,0.39,0.28}
\definecolor{lightgreen}{rgb}{0.48,0.99,0.0}
\definecolor{lightblue}{rgb}{0.53,0.81,0.92}
\definecolor{lightblue2}{rgb}{0.3,0.3,1.0}
\definecolor{lightpurple}{rgb}{0.87,0.63,0.87}
\definecolor{lightcyan}{rgb}{0.5,1.0,0.83}

\colorlet{comment_green}{green!50!black}
\colorlet{string_red}{red!60!black}
\colorlet{keyword_pink}{magenta!70!black}
\colorlet{indendifier_green}{green!70!white}

% Backgrounds for code
\definecolor{cbg_gray}{rgb}{.95, .95, .95}
\definecolor{bar_gray}{rgb}{.92, .92, .92}

\definecolor{cbg_yellowgray}{rgb}{.95, .95, .85}
\definecolor{bar_yellowgray}{rgb}{.95, .95, .65}

\colorlet{cbg_yellow2}{yellow!10}
\colorlet{bar_yellow2}{yellow!20}

\definecolor{cbg_yellow1}{rgb}{.98, .98, 0.8}
\definecolor{bar_yellow1}{rgb}{.98, .98, 0.4}

\definecolor{cbg_red1}{rgb}{1, 0.85, 0.85}
\definecolor{bar_red1}{rgb}{1, 0.75, 0.85}

\definecolor{cbg_blue1}{rgb}{0.87843, 0.95686, 1.0}
\definecolor{bar_blue1}{rgb}{0.7,     0.95686, 1}

\usepackage{listingsutf8}

% Common lstlisting parameters

\usepackage{calc}
\newlength{\lstboxwidth}  % width of lst box
\newlength{\framethickness}
\setlength{\framethickness}{0.5mm}
% for frame=trbl and a framerule that has significant size, set
% xleftmargin=5mm and xrightmargin=5mm.

\lstset{
  basicstyle=\small \ttfamily,
  breaklines=false,          % break/wrap lines
  breakatwhitespace=true,    % let linebreaks happen at whitespace
  breakindent=40pt,
  tab=,
  tabsize=4,                 % tab means 4 spaces
  %belowskip=\smallskipamount,  % space between code and text below
  xleftmargin=2mm,           % indentation of code frame
  xrightmargin=0mm,
  framexleftmargin=2mm,      % add frame space to the left of the code box
  %numbers=left,             % put line numbers on the left
  %stepnumber=2,             % stepnumber=1 numbers each line, =n every n lines
  framerule=\framethickness, % thickness of frame
  aboveskip=2ex,             % vertical space above code frame
  showstringspaces=false,    % show spaces in strings with an underscore
  showspaces=false,          % show spaces with an underscore
  showtabs=false,
  keepspaces=true,
  columns=fullflexible,      % tighter character kerning, like verb
  escapeinside={(*@}{@*)},   % (*@ \pause @*) in slides and math in code blocks
  extendedchars=\true,       % allows non-ascii chars, does not work with utf-8
}

% Internally defined styles for lstlisting

\lstdefinestyle{simple}{
commentstyle={},
}

% end of custom lstdefinestyles

\usepackage[T1]{fontenc}
%\usepackage[latin1]{inputenc}
\usepackage{ucs}
\usepackage[utf8x]{inputenc}

\usepackage{lmodern}         % Latin Modern fonts derived from Computer Modern

% Hyperlinks in PDF:

\usepackage{hyperref}
\hypersetup{
    breaklinks=true,
    colorlinks=true,
    linkcolor=black,
    urlcolor=black,
    citecolor=black,
    filecolor=black,
    %filecolor=blue,
    pdfmenubar=true,
    pdftoolbar=true,
    bookmarksdepth=3   % Uncomment (and tweak) for PDF bookmarks with more levels than the TOC
    }
%\hyperbaseurl{}   % hyperlinks are relative to this root

\setcounter{tocdepth}{3}  % levels in table of contents

\usepackage[framemethod=TikZ]{mdframed}

% --- begin definitions of admonition environments ---

% Admonition style "mdfbox" is an oval colored box based on mdframed
% "notice" admon
\definecolor{mdfbox_notice_background}{rgb}{1,1,1}
\newmdenv[
  skipabove=15pt,
  skipbelow=15pt,
  outerlinewidth=0,
  backgroundcolor=mdfbox_notice_background,
  linecolor=black,
  linewidth=2pt,       % frame thickness
  frametitlebackgroundcolor=mdfbox_notice_background,
  frametitlerule=true,
  frametitlefont=\normalfont\bfseries,
  shadow=false,        % frame shadow?
  shadowsize=11pt,
  leftmargin=0,
  rightmargin=0,
  roundcorner=5,
  needspace=0pt,
]{notice_mdfboxmdframed}

\newenvironment{notice_mdfboxadmon}[1][]{
\begin{notice_mdfboxmdframed}[frametitle=#1]
}
{
\end{notice_mdfboxmdframed}
}

% Admonition style "mdfbox" is an oval colored box based on mdframed
% "summary" admon
\definecolor{mdfbox_summary_background}{rgb}{1,1,1}
\newmdenv[
  skipabove=15pt,
  skipbelow=15pt,
  outerlinewidth=0,
  backgroundcolor=mdfbox_summary_background,
  linecolor=black,
  linewidth=2pt,       % frame thickness
  frametitlebackgroundcolor=mdfbox_summary_background,
  frametitlerule=true,
  frametitlefont=\normalfont\bfseries,
  shadow=false,        % frame shadow?
  shadowsize=11pt,
  leftmargin=0,
  rightmargin=0,
  roundcorner=5,
  needspace=0pt,
]{summary_mdfboxmdframed}

\newenvironment{summary_mdfboxadmon}[1][]{
\begin{summary_mdfboxmdframed}[frametitle=#1]
}
{
\end{summary_mdfboxmdframed}
}

% Admonition style "mdfbox" is an oval colored box based on mdframed
% "warning" admon
\definecolor{mdfbox_warning_background}{rgb}{1,1,1}
\newmdenv[
  skipabove=15pt,
  skipbelow=15pt,
  outerlinewidth=0,
  backgroundcolor=mdfbox_warning_background,
  linecolor=black,
  linewidth=2pt,       % frame thickness
  frametitlebackgroundcolor=mdfbox_warning_background,
  frametitlerule=true,
  frametitlefont=\normalfont\bfseries,
  shadow=false,        % frame shadow?
  shadowsize=11pt,
  leftmargin=0,
  rightmargin=0,
  roundcorner=5,
  needspace=0pt,
]{warning_mdfboxmdframed}

\newenvironment{warning_mdfboxadmon}[1][]{
\begin{warning_mdfboxmdframed}[frametitle=#1]
}
{
\end{warning_mdfboxmdframed}
}

% Admonition style "mdfbox" is an oval colored box based on mdframed
% "question" admon
\definecolor{mdfbox_question_background}{rgb}{1,1,1}
\newmdenv[
  skipabove=15pt,
  skipbelow=15pt,
  outerlinewidth=0,
  backgroundcolor=mdfbox_question_background,
  linecolor=black,
  linewidth=2pt,       % frame thickness
  frametitlebackgroundcolor=mdfbox_question_background,
  frametitlerule=true,
  frametitlefont=\normalfont\bfseries,
  shadow=false,        % frame shadow?
  shadowsize=11pt,
  leftmargin=0,
  rightmargin=0,
  roundcorner=5,
  needspace=0pt,
]{question_mdfboxmdframed}

\newenvironment{question_mdfboxadmon}[1][]{
\begin{question_mdfboxmdframed}[frametitle=#1]
}
{
\end{question_mdfboxmdframed}
}

% Admonition style "mdfbox" is an oval colored box based on mdframed
% "block" admon
\definecolor{mdfbox_block_background}{rgb}{1,1,1}
\newmdenv[
  skipabove=15pt,
  skipbelow=15pt,
  outerlinewidth=0,
  backgroundcolor=mdfbox_block_background,
  linecolor=black,
  linewidth=2pt,       % frame thickness
  frametitlebackgroundcolor=mdfbox_block_background,
  frametitlerule=true,
  frametitlefont=\normalfont\bfseries,
  shadow=false,        % frame shadow?
  shadowsize=11pt,
  leftmargin=0,
  rightmargin=0,
  roundcorner=5,
  needspace=0pt,
]{block_mdfboxmdframed}

\newenvironment{block_mdfboxadmon}[1][]{
\begin{block_mdfboxmdframed}[frametitle=#1]
}
{
\end{block_mdfboxmdframed}
}

% --- end of definitions of admonition environments ---

% prevent orhpans and widows
\clubpenalty = 10000
\widowpenalty = 10000

\newenvironment{doconceexercise}{}{}
\newcounter{doconceexercisecounter}% --- begin definition of \listofexercises command ---
\makeatletter
\newcommand\listofexercises{
\chapter*{List of Problems
          \@mkboth{List of Problems}{List of Problems}}
\markboth{List of Problems}{List of Problems}
\@starttoc{loe}
}
\newcommand*{\l@doconceexercise}{\@dottedtocline{0}{0pt}{6.5em}}
\makeatother
% --- end definition of \listofexercises command ---


% Let exercises, problems, and projects be numbered per chapter:
\usepackage{chngcntr}
\counterwithin{doconceexercisecounter}{chapter}

% \subex{} is defined in t2do.sty or t4do.sty

% Redefine double page clear to make it a blank page without headers
% (from BYUTextbook)
\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
\hbox{}
\thispagestyle{empty}
\newpage
\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother
% These commands fiddle with the space left for page numbers in the TOC
% (from BYUTextbook)
\makeatletter
%\renewcommand{\@pnumwidth}{2em}
%\renewcommand{\@tocrmarg}{2.85em}
\makeatother

% --- end of standard preamble for documents ---


% insert custom LaTeX commands...

\raggedbottom
\makeindex
\usepackage[totoc]{idxlayout}   % for index in the toc
\usepackage[nottoc]{tocbibind}  % for references/bibliography in the toc

%-------------------- end preamble ----------------------

\begin{document}

% matching end for #ifdef PREAMBLE
% #endif

\newcommand{\exercisesection}[1]{\subsection*{#1}}

\input{newcommands_keep}

% ------------------- main content ----------------------

% Note on the Springer T2 style: used the modifications in t2do.sty
% and svmonodo.cls (come bundled with DocOnce).


\frontmatter
\setcounter{page}{3}
\pagestyle{headings}


% ----------------- title -------------------------

\thispagestyle{empty}
\hbox{\ \ }
\vfill
\begin{center}
{\huge{\bfseries{
\begin{spacing}{1.25}
{\rule{\linewidth}{0.5mm}} \\[0.4cm]
{Test of DocOnce-Based Book with Springer's T2/T4 Styles}
\\[0.4cm] {\rule{\linewidth}{0.5mm}} \\[1.5cm]
\end{spacing}
}}}

% ----------------- author(s) -------------------------

\vspace{0.5cm}

{\Large\textsf{Hans Petter Langtangen${}^{1, 2}$}}\\ [3mm]

\ \\ [2mm]

{\large\textsf{${}^1$Center for Biomedical Computing, Simula Research Laboratory} \\ [1.5mm]}
{\large\textsf{${}^2$Department of Informatics, University of Oslo} \\ [1.5mm]}
% ----------------- end author(s) -------------------------

% --- begin date ---
\ \\ [10mm]
{\large\textsf{Jan 32, 2100}}
\end{center}
% --- end date ---
\vfill
\clearpage

\setpagesize

\chapter*{Preface}
\addcontentsline{toc}{chapter}{Preface}

The aim of this book is to teach computer programming using examples
from mathematics and the natural sciences.  We have chosen to use the
Python programming language because it combines remarkable expressive
power with very clean, simple, and compact syntax.  Python is easy to
learn and very well suited for an introduction to computer
programming. Python is also quite similar to MATLAB and a good
language for doing mathematical computing.  It is easy to combine
Python with compiled languages, like Fortran, C, and C++, which are
widely used languages for scientific computations.  A seamless
integration of Python with Java is offered by a special version of
Python called Jython.

The examples in this book integrate programming with applications to
mathematics, physics, biology, and finance.  The reader is expected to
have knowledge of basic one-variable calculus as taught in
mathematics-intensive programs in high schools. It is certainly an
advantage to take a university calculus course in parallel, preferably
containing both classical and numerical aspects of calculus.  Although
not strictly required, a background in high school physics makes many
of the examples more meaningful.

Many introductory programming books are quite compact and focus on
listing functionality of a programming language. However, learning to
program is learning how to \emph{think} as a programmer.  This book
has its main focus on the thinking process, or equivalently:
programming as a problem solving technique. That is why most of the
pages are devoted to case studies in programming, where we define a
problem and explain how to create the corresponding program.  New
constructions and programming styles (what we could call theory) is also usually
introduced via examples.  Special attention is paid to verification of
programs and to finding errors. These topics are very demanding for
mathematical software, because the unavoidable numerical
approximation errors are possibly mixed with programming mistakes.

By studying the many examples in the
book, I hope readers will learn how to think right and thereby
write programs in a quicker and more reliable way. Remember, nobody can learn
programming by just reading - one has to solve a large amount of
exercises hands on.  The book is therefore full of exercises of
various types: modifications of existing examples, completely new
problems, or debugging of given programs.

\paragraph{Python version 2 or 3?}
A common problem among Python programmers is to choose between version
2 or 3, which at the time of this writing means choosing
between version 2.7 and 3.3.
The general recommendation is to go for version 3, but programs are
then not compatible with version 2 and vice versa. There is still
a problem that much useful mathematical software in Python
has not yet been ported to version 3. Therefore, scientific computing
with Python still goes mostly with version 2.
A widely used strategy for software
developers who want to write Python code that works with both versions,
is to develop for v2.7, which is very close to what is accepted
in version 3, and then
use the ranslation tool \emph{2to3} to automatically translate the code
to version 3.

When using v2.7, one should employ the newest syntax
and modules that make the differences beween version 2 and 3 very small.
This strategy is adopted in the present book. Only two
differences between versions 2 and 3 are expected to be significant for
the programs in the book:
\texttt{a/b} implies float division in version 3 if \texttt{a} and \texttt{b}
are integers,
and \texttt{print('Hello')} in version 2 must be turned into a function call
\texttt{print('Hello')} in version 3. None of these differences should lead
to any annoying problems when future readers study the book's v2.7
examples, but program in version 3. Anyway, running 2to3 on the
example files generates the corresponding version 3 code.

\paragraph{Acknowledgments.}
Several people have helped to make substantial improvements of the
text. Here I list only the names with Norwgian characters to
test the handling of those: Ståle Zerener Haugnæss,
Tobias Vidarssønn Langhoff, and Håkon Møller.

\vspace{1cm}

\noindent
\emph{Oslo, May 2015}  \hfill  \emph{Hans Petter Langtangen}

\tableofcontents
\clearemptydoublepage
\listofexercises
\clearemptydoublepage


\vspace{1cm} % after toc

\mainmatter

\chapter{Basic array computing and plotting}

This chapter gives an introduction to arrays: how they are created
and what they can be used for.  Array computing usually ends up with a
lot of numbers. It may be very hard to understand what these numbers
mean by just looking at them. Since the human is a visual animal, a
good way to understand numbers is to visualize them. In this
chapter we concentrate on visualizing curves that reflect functions
of one variable; i.e., curves of the form $y=f(x)$.  A synonym for
curve is graph, and the image of curves on the screen is often called
a plot.  We will use arrays to store the information about points
along the curve. In a nutshell, array computing demands visualization
and visualization demands arrays.

All program examples in this chapter can be found as files in the
folder \href{{https://some.where.net/doconce/test/software/plot}}{\nolinkurl{src/plot}\footnote{\texttt{https://some.where.net/doconce/test/software/plot}}}.

\section{Arrays in Python programs}
\label{sec:plot:arraycomp}

This section introduces array programming in Python, but first we
create some lists and show how arrays differ from lists.

\subsection{Using lists for collecting function data}
\label{sec:plot:listdata}

Suppose we have a function $f(x)$ and want to evaluate this function
at a number of $x$ points $x_0,x_1,\ldots,x_{n-1}$.  We could collect
the $n$ pairs $(x_i,f(x_i))$ in a list, or we could collect all the
$x_i$ values, for $i=0,\ldots,n-1$, in a list and all the associated
$f(x_i)$ values in another list.  The following interactive session
demonstrates how to create these three types of lists:










\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
>>> def f(x):
...     return x**3       # sample function
...
>>> n = 5                 # no of points along the x axis
>>> dx = 1.0/(n-1)        # spacing between x points in [0,1]
>>> xlist = [i*dx for i in range(n)]
>>> ylist = [f(x) for x in xlist]
>>> pairs = [[x, y] for x, y in zip(xlist, ylist)]

\end{lstlisting}

Here we have used list comprehensions for achieving compact code. Make
sure that you understand what is going on in these list comprehensions
(if not, try to write the same code using standard \texttt{for} loops and
appending new list elements in each pass of the loops).

\index{heterogeneous lists}

The list elements consist of objects of the same type: any element in
\texttt{pairs} is a list of two \texttt{float} objects, while any element in \texttt{xlist}
or \texttt{ylist} is a \texttt{float}. Lists are more flexible than that, because an
element can be an object of any type, e.g.,



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
mylist = [2, 6.0, 'tmp.ps', [0,1]]

\end{lstlisting}

Here \texttt{mylist} holds an \texttt{int}, a \texttt{float}, a string, and a list. This
combination of diverse object types makes up what is known as
\emph{heterogeneous} lists.  We can also easily remove elements from a list
or add new elements anywhere in the list.  This flexibility of lists
is in general convenient to have as a programmer, but in cases where
the elements are of the same type and the number of elements is fixed,
arrays can be used instead. The benefits of arrays are faster
computations, less memory demands, and extensive support for
mathematical operations on the data.  Because of greater efficiency
and mathematical convenience, arrays will be used to a large extent in
this book.  The great use of arrays is also prominent in other
programming environments such as MATLAB, Octave, and R, for instance.
Lists will be our choice instead of arrays when we need the
flexibility of adding or removing elements or when the elements may be
of different object types.


\begin{quote}
\emph{People only become computer programmers if they're
obsessive about details, crave power over machines, and can bear
to be told day after day exactly how
stupid they are.} \\
Gregory J. E. Rawlins \cite{Rawlins_1998}, computer scientist.
\end{quote}


\subsection{Basics of numerical Python arrays}
\label{sec:plot:array:basics}

\index{Numerical Python} \index{NumPy} \index{numpy@{\rm\texttt{numpy}}}
\index{array (datatype)} \index{array computing}
\index{vectorization}

An \emph{array} object can be viewed as a variant of a list, but with the
following assumptions and features:

\begin{itemize}
  \item All elements must be of the same type, preferably integer, real, or complex numbers, for efficient numerical computing and storage.

  \item The number of elements must be known when the array is created.

  \item Arrays are not part of standard Python - one needs an additional package called \emph{Numerical Python}, often abbreviated as NumPy. The Python name of the package, to be used in \texttt{import} statements, is \texttt{numpy}.

  \item With \texttt{numpy}, a wide range of mathematical operations can be done directly on complete arrays, thereby removing the need for loops over array elements. This is commonly called \emph{vectorization} %or \emph{array computing} and may cause a dramatic speed-up of Python programs. Vectorization makes use of the vector computing concepts from Section~\ref{sec:plot:arraycomp}.

  \item Arrays with one index are often called vectors. Arrays with two indices are used as an efficient data structure for tables, instead of lists of lists. Arrays can also have three or more indices.
\end{itemize}

\noindent

\begin{notice_mdfboxadmon}[Remarks]

\begin{enumerate}
\item There is actually an object type called \texttt{array} in standard Python, but this data type is not so efficient for mathematical computations, and we will not use it in this book.

\item The number of elements in an array \emph{can} be changed, but at a substantial computational cost.
\end{enumerate}

\noindent
\end{notice_mdfboxadmon} % title: Remarks



The following text lists some important functionality of NumPy arrays.
A more comprehensive treatment is found in the excellent \emph{NumPy
Tutorial}, \emph{NumPy User Guide}, \emph{NumPy Reference}, \emph{Guide to NumPy},
and \emph{NumPy for MATLAB Users}, all accessible at \href{{https://scipy.org}}{scipy.org}\footnote{\texttt{https://scipy.org}}.

\index{zeros@{\rm\texttt{zeros}} (from {\rm\texttt{numpy}})} \index{np.zeros@{\rm\texttt{np.zeros}} function}
\index{array@{\rm\texttt{array}} (from {\rm\texttt{numpy}})} \index{np.array@{\rm\texttt{np.array}} function}
\index{np@{\rm\texttt{np}} prefix ({\rm\texttt{numpy}})}
\index{zeros\_like@{\rm\texttt{zeros\_like}} (from {\rm\texttt{numpy}})}\index{np.zeros\_like@{\rm\texttt{np.zeros\_like}} function}


\begin{notice_mdfboxadmon}[Remarks on importing NumPy]
The statement



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
import numpy as np

\end{lstlisting}

with subsequent prefixing of all NumPy functions and variables by \texttt{np.},
has evolved as a standard syntax in the Python scientific computing
community. However, to make Python programs look closer to MATLAB
and ease the transition to and from that language, one can do



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
from numpy import *

\end{lstlisting}

to get rid of the prefix (this is evolved as the standard in
\emph{interactive} Python shells). This author prefers mathematical
functions from \texttt{numpy} to be written without the prefix to
make the formulas as close as possible to the mathematics.
So, $f(x)=\sinh(x-1)\sin(w t)$ would be coded as






\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
from numpy import sinh, sin

def f(x):
    return sinh(x-1)*sin(w*t)

\end{lstlisting}

or one may take the less recommended
lazy approach \texttt{from numpy import *} and fill up
the program with \emph{a lot} of functions and variables from \texttt{numpy}.
\end{notice_mdfboxadmon} % title: Remarks on importing NumPy



To convert a list \texttt{r} to an array,
we use the \texttt{array} function
from \texttt{numpy}:



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
a = np.array(r)

\end{lstlisting}

To create a new array of length \texttt{n}, filled with zeros, we write



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
a = np.zeros(n)

\end{lstlisting}

The array elements are of a type that corresponds to Python's
\texttt{float} type. A second argument to \texttt{np.zeros} can be used to
specify other element types, e.g., \texttt{int}.
A similar function,



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
a = np.zeros_like(c)

\end{lstlisting}

generates an array of zeros where the length is that of the array \texttt{c}
and the element type is the same as those in \texttt{c}.

\index{linspace@{\rm\texttt{linspace}} (from {\rm\texttt{numpy}})}\index{np.linspace@{\rm\texttt{np.linspace}} function}

Often one wants an array to have $n$ elements with uniformly
distributed values in an interval $[p,q]$. The \texttt{numpy} function
\texttt{linspace} creates such arrays:



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
a = np.linspace(p, q, n)

\end{lstlisting}



\begin{center}
{\small   % for Springer style: small table font and more vspace

\vspace{4mm}

\begin{tabular}{ll}
\hline
\multicolumn{1}{c}{ Construction } & \multicolumn{1}{c}{ Meaning } \\
\hline
\texttt{array(ld)}       & copy list data \texttt{ld} to a \texttt{numpy} array                    \\
\texttt{asarray(d)}      & make array of data \texttt{d} (no data copy if already array)         \\
\texttt{zeros(n)}        & make a \texttt{float} vector/array of length \texttt{n}, with zeros     \\
\texttt{zeros(n, int)}   & make an \texttt{int} vector/array of length \texttt{n} with zeros       \\
\texttt{zeros((m,n))}    & make a two-dimensional \texttt{float} array with shape (\texttt{m},`n`) \\
\Verb!zeros_like(x)!   & make array of same shape and element type as \texttt{x}               \\
\texttt{linspace(a,b,m)} & uniform sequence of \texttt{m} numbers in $[a,b]$                     \\
\texttt{a.shape}         & tuple containing \texttt{a}'s shape                                   \\
\texttt{a.size}          & total no of elements in \texttt{a}                                    \\
\texttt{len(a)}          & length of a one-dim. array \texttt{a} (same as \texttt{a.shape[0]})     \\
\texttt{a.dtype}         & the type of elements in \texttt{a}                                    \\
\texttt{a.reshape(3,2)}  & return \texttt{a} reshaped as $3\times 2$ array                       \\
\texttt{a[i]}            & vector indexing                                                     \\
\texttt{a[i,j]}          & two-dim. array indexing                                             \\
\texttt{a[1:k]}          & slice: reference data with indices \texttt{1},\ldots,`k-1`            \\
\texttt{a[1:8:3]}        & slice: reference data with indices \texttt{1}, \texttt{4},\ldots,`7`    \\
\texttt{b = a.copy()}    & copy an array                                                       \\
\hline
\end{tabular}

\vspace{4mm}

}
\end{center}

\noindent
\chapter{Storing results in data files and adding more words here to get a very long chapter heading}

We need to test spaces around footnotes for 2-digit footnotes, which
means we need a lot of URLs, e.g., to files:
\href{{https://some.where.net/doconce/test/software/input/ball2_cml.py}}{\nolinkurl{ball2_cml.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/ball2\_cml.py}}},
\href{{https://some.where.net/doconce/test/software/input/bisection_ex.py}}{\nolinkurl{bisection_ex.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/bisection\_ex.py}}},
\href{{https://some.where.net/doconce/test/software/input/bisection_movie.py}}{\nolinkurl{bisection_movie.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/bisection\_movie.py}}},
\href{{https://some.where.net/doconce/test/software/input/bisection_plot.py}}{\nolinkurl{bisection_plot.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/bisection\_plot.py}}},
\href{{https://some.where.net/doconce/test/software/input/bisection.py}}{\nolinkurl{bisection.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/bisection.py}}},
\href{{https://some.where.net/doconce/test/software/input/bisection_v1.py}}{\nolinkurl{bisection_v1.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/bisection\_v1.py}}},
\href{{https://some.where.net/doconce/test/software/input/bisection_v2.py}}{\nolinkurl{bisection_v2.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/bisection\_v2.py}}},
\href{{https://some.where.net/doconce/test/software/input/c2f_cml.py}}{\nolinkurl{c2f_cml.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/c2f\_cml.py}}},
\href{{https://some.where.net/doconce/test/software/input/data.txt}}{\nolinkurl{data.txt}\footnote{\texttt{https://some.where.net/doconce/test/software/input/data.txt}}},
\href{{https://some.where.net/doconce/test/software/input/Fdeg.dat}}{\nolinkurl{Fdeg.dat}\footnote{\texttt{https://some.where.net/doconce/test/software/input/Fdeg.dat}}},
\href{{https://some.where.net/doconce/test/software/input/integrate.py}}{\nolinkurl{integrate.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/integrate.py}}}, and
\href{{https://some.where.net/doconce/test/software/input/interest.py}}{\nolinkurl{interest.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/interest.py}}}.

\section{Writing data to file}
\label{sec:files:writing}

Writing data to file is easy.
There is basically one function to pay attention to: \texttt{outfile.write(s)},
which writes a string \texttt{s} to
a file handled by the file object \texttt{outfile}. Unlike \texttt{print},
\texttt{outfile.write(s)}
does not append a newline character to the written string.
It will therefore
often be necessary to add a newline character,



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
outfile.write(s + '\n')

\end{lstlisting}

if the string \texttt{s} is meant to appear on a single line in the file
and \texttt{s} does not already contain a trailing newline character.
File writing is then a matter of constructing strings containing the
text we want to have in the file and for each such string call
\texttt{outfile.write}.

Writing to a file demands
the file object \texttt{f}
to be opened for writing:







\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
# write to new file, or overwrite file:
outfile = open(filename, 'w')

# append to the end of an existing file:
outfile = open(filename, 'a')

\end{lstlisting}


\subsection{Example: Writing a table to file}

\paragraph{Problem.}
As a worked example of file writing,
we shall write out a nested list with tabular data to file.
A sample list may take look as






\begin{lstlisting}[language=Python,style=simple,xleftmargin=2mm]
[[ 0.75,        0.29619813, -0.29619813, -0.75      ],
 [ 0.29619813,  0.11697778, -0.11697778, -0.29619813],
 [-0.29619813, -0.11697778,  0.11697778,  0.29619813],
 [-0.75,       -0.29619813,  0.29619813,  0.75      ]]

\end{lstlisting}


\paragraph{Solution.}
We iterate through the rows (first index) in the list, and for each row,
we iterate through the column values (second index)
and write each value to the file.
At the end of each row, we must insert a newline character in the file to get
a linebreak. The code resides in the file \href{{https://some.where.net/doconce/test/software/input/write1.py}}{\nolinkurl{write1.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/write1.py}}}.

The resulting data file becomes






\begin{lstlisting}[language=Python,style=simple,xleftmargin=2mm]
    0.75000000    0.29619813   -0.29619813   -0.75000000
    0.29619813    0.11697778   -0.11697778   -0.29619813
   -0.29619813   -0.11697778    0.11697778    0.29619813
   -0.75000000   -0.29619813    0.29619813    0.75000000

\end{lstlisting}


An extension of this program consists in adding column and row headings:







\begin{lstlisting}[language=Python,style=simple,xleftmargin=2mm]
           column  1     column  2     column  3     column  4
row  1    0.75000000    0.29619813   -0.29619813   -0.75000000
row  2    0.29619813    0.11697778   -0.11697778   -0.29619813
row  3   -0.29619813   -0.11697778    0.11697778    0.29619813
row  4   -0.75000000   -0.29619813    0.29619813    0.75000000

\end{lstlisting}

To obtain this end result, we need to the add some statements to
the program \texttt{write1.py}. For the column headings we need
to know the number of columns, i.e., the length of the rows,
and loop from 1 to this length:







\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
ncolumns = len(data[0])
outfile.write('          ')
for i in range(1, ncolumns+1):
    outfile.write('%10s    ' % ('column %2d' % i))
outfile.write('\n')

\end{lstlisting}

Note the use of a nested printf construction: The text we want to
insert is itself a printf string. We could also have written the
text as \texttt{'column  ' + str(i)}, but then the length of the
resulting string would depend on the number of digits in \texttt{i}.
It is recommended to always use printf constructions for
a tabular output format, because this gives automatic padding of
blanks so that the width of the output strings remain the same.
As always, the tuning of the widths is done in a trial-and-error
process.

To add the row headings, we need a counter over the row numbers:









\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
row_counter = 1
for row in data:
    outfile.write('row %2d' % row_counter)
    for column in row:
        outfile.write('%14.8f' % column)
    outfile.write('\n')
    row_counter += 1

\end{lstlisting}

The complete code is found in the file \href{{https://some.where.net/doconce/test/software/input/write2.py}}{\nolinkurl{write2.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/write2.py}}}.
We could, alternatively, iterate over the indices in the list:







\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
for i in range(len(data)):
    outfile.write('row %2d' % (i+1))
    for j in range(len(data[i])):
        outfile.write('%14.8f' % data[i][j])
    outfile.write('\n')

\end{lstlisting}

Some other files and URLs we can mention, just to test a 2-digit footnote,
are

\begin{itemize}
 \item \href{{https://some.where.net/doconce/test/software/input/addall.py}}{\nolinkurl{addall.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/addall.py}}}

 \item \href{{https://some.where.net/doconce/test/software/input/addall_v1.py}}{\nolinkurl{addall_v1.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/addall\_v1.py}}}

 \item \href{{https://some.where.net/doconce/test/software/input/add_cml.py}}{\nolinkurl{add_cml.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/add\_cml.py}}}

 \item \href{{https://some.where.net/doconce/test/software/input/add_input.py}}{\nolinkurl{add_input.py}\footnote{\texttt{https://some.where.net/doconce/test/software/input/add\_input.py}}}
\end{itemize}

\noindent
\subsection{Standard input and output as file objects}

\index{standard input} \index{standard output}

\index{sys.stdin@{\rm\texttt{sys.stdin}}}\index{sys.stdout@{\rm\texttt{sys.stdout}}}

Reading user input from the keyboard applies the function
\Verb!raw_input! as explained in another section.
The keyboard is a medium that the computer in fact
treats as a file, referred to
as \emph{standard input}.

The \texttt{print} command prints text in the terminal window. This medium
is also viewed as a file from the computer's point of view and called
\emph{standard output}. All general-purpose programming languages
allow reading from standard input and
writing to standard output. This reading and writing can be done with
two types of tools, either file-like objects or special tools like
\Verb!raw_input!
and \texttt{print} in Python.
We will here describe the file-line objects:
\texttt{sys.stdin} for standard input
and \texttt{sys.stdout} for standard output. These objects
behave as file objects, except that they do not need to be opened or
closed. The statement



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
s = raw_input('Give s:')

\end{lstlisting}

is equivalent to




\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
print('Give s: '),
s = sys.stdin.readline()

\end{lstlisting}

Recall that the trailing comma in the \texttt{print} statement avoids the
newline that \texttt{print} by default adds to the output string.
Similarly,



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
s = eval(raw_input('Give s:'))

\end{lstlisting}

is equivalent to




\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
print('Give s: '),
s = eval(sys.stdin.readline())

\end{lstlisting}

For output to the terminal window, the statement



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
print(s)

\end{lstlisting}

is equivalent to



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
sys.stdout.write(s + '\n')

\end{lstlisting}


Why it is handy to have access to standard input and output
as file objects can be illustrated by an example. Suppose you have a
function that reads data from a file object \texttt{infile}
and writes data to a file object \texttt{outfile}.
A sample function may take the form







\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
def x2f(infile, outfile, f):
    for line in infile:
        x = float(line)
        y = f(x)
        outfile.write('%g\n' % y)

\end{lstlisting}

This function works with all types of files, including
web pages as \texttt{infile}.
With \texttt{sys.stdin} as \texttt{infile} and/or \texttt{sys.stdout}
as \texttt{outfile}, the \texttt{x2f} function also works with standard input
and/or standard output. Without \texttt{sys.stdin} and \texttt{sys.stdout},
we would need different code, employing \Verb!raw_input!
and \texttt{print},
to deal with standard input and output. Now we can write a single
function that deals with all file media in a unified way.

\index{standard error}
\index{sys.stderr@{\rm\texttt{sys.stderr}}}

There is also something called \emph{standard error}.
Usually this is the terminal window, just as standard output, but
programs can distinguish between writing ordinary output to standard
output and error messages to standard error, and these output media
can be redirected to, e.g., files such that one can separate
error messages from ordinary output.
In Python, standard error is the file-like object \texttt{sys.stderr}.
A typical application of \texttt{sys.stderr} is to report errors:




\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
if x < 0:
    sys.stderr.write('Illegal value of x'); sys.exit(1)

\end{lstlisting}

This message to \texttt{sys.stderr} is an alternative to
\texttt{print} or raising an exception.

\paragraph{Redirecting standard input, output, and error.}
Standard output from a program \texttt{prog}
can be redirected to a file
\texttt{output} instead of the screen, by
using the greater than sign:



\begin{lstlisting}[language=bash,style=simple,xleftmargin=2mm]
Terminal> prog > output

\end{lstlisting}

Here, \texttt{prog} can be any
program, including a Python program run as \texttt{python myprog.py}.
Similarly, output to the medium called \emph{standard error}
can be redirected by



\begin{lstlisting}[language=bash,style=simple,xleftmargin=2mm]
Terminal> prog &> output

\end{lstlisting}

For example, error messages are normally written to standard error, which
is exemplified in this little terminal session on a Unix machine:









\begin{lstlisting}[language=bash,style=simple,xleftmargin=2mm]
Terminal> ls bla-bla1 bla-bla2
ls: cannot access bla-bla1: No such file or directory
ls: cannot access bla-bla2: No such file or directory
Terminal> ls bla-bla1 bla-bla2 &> errors
Terminal> cat errors  # print the file errors
ls: cannot access bla-bla1: No such file or directory
ls: cannot access bla-bla2: No such file or directory

\end{lstlisting}

When the program reads from standard input (the keyboard),
we can equally well redirect
standard input to a file, say with name \Verb!raw_input!, such that
the program reads from this file rather than from the keyboard:



\begin{lstlisting}[language=bash,style=simple,xleftmargin=2mm]
Terminal> prog < input

\end{lstlisting}

Combinations are also possible:



\begin{lstlisting}[language=bash,style=simple,xleftmargin=2mm]
Terminal> prog < input > output

\end{lstlisting}


\paragraph{Note.}
The redirection of standard output, input, and error
does not work for Python programs executed with the \texttt{run}
command inside IPython, only when executed directly
in the operating system in a terminal window, or with the same
command prefixed with an exclamation mark in IPython.

\paragraph{References.}
To check the bibliography, we need to make citations to a book{TCSE3},
Matplotlib \cite{Matplotlib:paper}, and more books \cite{Mertz,PythonQt}
as well as Python itself \cite{Python}, and of course NumPy
\cite{NumPy}.

\section{Exercises}

% --- begin exercise ---
\begin{doconceexercise}
\refstepcounter{doconceexercisecounter}

\exercisesection{Problem \thedoconceexercisecounter: Add numbers}
                \addcontentsline{loe}{doconceexercise}{Problem \thedoconceexercisecounter: Add numbers}
                
\label{exer:add}

Compute

\[ 1 + 1 \]

% --- begin answer of exercise ---
\paragraph{Answer.}


% --- end answer of exercise ---

% --- begin solution of exercise ---
\paragraph{Solution.}
Python shell as calculator:




\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
>>> 1 + 1


\end{lstlisting}


% --- end solution of exercise ---
\noindent Filename: \texttt{add}.

\end{doconceexercise}
% --- end exercise ---

% --- begin exercise ---
\begin{doconceexercise}
\refstepcounter{doconceexercisecounter}

\exercisesection{Problem \thedoconceexercisecounter: Multiply numbers}
                \addcontentsline{loe}{doconceexercise}{Problem \thedoconceexercisecounter: Multiply numbers}
                
\label{exer:mul}

% --- begin subexercise ---
\subex{a)}
Compute $1\cdot 3$.

% --- begin answer of exercise ---
\paragraph{Answer.}

% --- end answer of exercise ---

% --- end subexercise ---

% --- begin subexercise ---
\subex{b)}
Compute $2\cdot 3$.

% --- begin hint in exercise ---

\paragraph{Hint.}
Use a Python shell.

% --- end hint in exercise ---

% --- begin solution of exercise ---
\paragraph{Solution.}



\begin{lstlisting}[language=python,style=simple,xleftmargin=2mm]
>>> 2*3


\end{lstlisting}

% --- end solution of exercise ---

% --- end subexercise ---

\noindent Filename: \texttt{multiply}.

\end{doconceexercise}
% --- end exercise ---



\appendix

\chapter{Styles for Springer T2/T4}

The T2/T4 style for DocOnce-generated {\LaTeX} should make use of
slightly modified \texttt{svmono.cls} and \texttt{t2.sty} files:

\begin{itemize}
 \item \texttt{svmonodo.cls}

 \item \texttt{t2do.sty} or \texttt{t4do.sty}
\end{itemize}

\noindent
\clearemptydoublepage
\markboth{Bibliography}{Bibliography}
\thispagestyle{empty}

\bibliographystyle{plain}
\bibliography{papers}

% ------------------- end of main content ---------------

% #ifdef PREAMBLE
\cleardoublepage\phantomsection  % trick to get correct link to Index
\printindex

\end{document}
% #endif

